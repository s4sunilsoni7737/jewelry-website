<%- include('../partials/head') %>
<%- include('../partials/header') %>
<%- include('../partials/messages') %>

<style>
  /* Add Product Page - Contact Page Style */
  .form-container {
    background: linear-gradient(135deg, #fff 0%, #fefefe 100%);
    border: 2px solid #e0bf50;
    border-radius: 15px;
    padding: 40px;
    box-shadow: 0 8px 25px rgba(224, 191, 80, 0.1);
    transition: transform 0.3s ease;
    margin-bottom: 30px;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  .form-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(224, 191, 80, 0.15);
  }

  .page-title {
    color: #2c2c2c;
    font-weight: 700;
    font-size: 2.5rem;
    margin-bottom: 30px;
    text-align: center;
  }

  .form-section {
    background: #fff;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    border: 1px solid #e9ecef;
  }

  .section-title {
    color: #2c2c2c;
    font-weight: 600;
    font-size: 1.3rem;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 4px solid #e0bf50;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-icon {
    color: #e0bf50;
    font-size: 1.2rem;
  }

  .form-label {
    font-weight: 600;
    color: #2c2c2c;
    margin-bottom: 8px;
    font-size: 1rem;
  }

  .form-control, .form-select {
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .form-control:focus, .form-select:focus {
    border-color: #e0bf50;
    box-shadow: 0 0 0 0.2rem rgba(224, 191, 80, 0.25);
  }

  .btn-primary-gold {
    background: linear-gradient(135deg, #e0bf50, #ffc107);
    border: none;
    color: #000;
    font-weight: 600;
    padding: 0.75rem 2rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 1rem;
    width: 100%;
    margin-top: 20px;
  }

  .btn-primary-gold:hover {
    background: linear-gradient(135deg, #ffc107, #ffed4e);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(224, 191, 80, 0.3);
    color: #000;
  }

  .back-button {
    margin-bottom: 20px;
  }

  .image-preview-container {
    background: rgba(224, 191, 80, 0.05);
    border: 2px dashed #e0bf50;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
  }

  .image-preview-container:hover {
    background: rgba(224, 191, 80, 0.1);
  }

  .image-preview {
    max-width: 200px;
    max-height: 200px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(224, 191, 80, 0.2);
  }

  .price-toggle {
    background: rgba(224, 191, 80, 0.05);
    border: 2px solid #e0bf50;
    border-radius: 8px;
    padding: 15px;
  }

  .form-check-input:checked {
    background-color: #e0bf50;
    border-color: #e0bf50;
  }

  .input-group-text {
    background: linear-gradient(135deg, #e0bf50, #ffc107);
    border: 2px solid #e0bf50;
    color: #000;
    font-weight: 600;
  }

  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .form-container {
      margin: 0 15px;
      padding: 25px;
    }
    
    .page-title {
      font-size: 2rem;
    }
    
    .form-section {
      padding: 20px;
    }
  }

  /* Animation for page load */
  @keyframes fadeInUp {
    from { 
      opacity: 0; 
      transform: translateY(30px); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0); 
    }
  }

  .form-container {
    animation: fadeInUp 0.6s ease-out;
  }
</style>

<a type="button" class="btn btn-outline-warning back-button" href="/products">
  <i class="fa-solid fa-arrow-left"></i>
</a>

<div class="container">
  <div class="form-container">
    <h1 class="page-title">
      <i class="fas fa-plus-circle me-3" style="color: #ffd700;"></i>
      <span class="lang" data-en="Add New Product" data-hi="à¤¨à¤¯à¤¾ à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚">Add New Product</span>
    </h1>

    <% if (!session.isSeller) { %>
      <div class="alert alert-danger">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span class="lang" data-en="Only shop owners can add products." data-hi="à¤•à¥‡à¤µà¤² à¤¦à¥à¤•à¤¾à¤¨ à¤®à¤¾à¤²à¤¿à¤• à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤œà¥‹à¤¡à¤¼ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤">Only shop owners can add products.</span>
      </div>
    <% } else { %>

    <p class="text-muted mb-4">You are adding products to: <strong><%= currentShop.name %>'s Shop</strong></p>

    <form class="needs-validation" id="addProductForm" action="/products/add" method="POST" enctype="multipart/form-data" novalidate>

      <!-- Basic Information Section -->
      <div class="form-section">
        <h4 class="section-title">
          <i class="fas fa-info-circle section-icon"></i>
          <span class="lang" data-en="Basic Information" data-hi="à¤¬à¥à¤¨à¤¿à¤¯à¤¾à¤¦à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€">Basic Information</span>
        </h4>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="name" class="form-label">
              <span class="lang" data-en="Product Name" data-hi="à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤•à¤¾ à¤¨à¤¾à¤®">Product Name</span>
              <span class="text-danger">*</span>
            </label>
            <input type="text" class="form-control" id="name" name="name" required value="<%= typeof product !== 'undefined' ? product.name : '' %>">
            <div class="invalid-feedback">
              <span class="lang" data-en="Please provide a product name." data-hi="à¤•à¥ƒà¤ªà¤¯à¤¾ à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤•à¤¾ à¤¨à¤¾à¤® à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¤°à¥‡à¤‚à¥¤">Please provide a product name.</span>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="category" class="form-label">
              <span class="lang" data-en="Category" data-hi="à¤¶à¥à¤°à¥‡à¤£à¥€">Category</span>
              <span class="text-danger">*</span>
            </label>
            <select class="form-select" id="category" name="category" required>
              <option value="">
                <span class="lang" data-en="Select Category" data-hi="à¤¶à¥à¤°à¥‡à¤£à¥€ à¤šà¥à¤¨à¥‡à¤‚">Select Category</span>
              </option>
              <% categories.forEach(cat => { %>
                <option value="<%= cat._id %>"><%= cat.name %></option>
              <% }) %>
            </select>
            <div class="invalid-feedback">
              <span class="lang" data-en="Please select a category." data-hi="à¤•à¥ƒà¤ªà¤¯à¤¾ à¤à¤• à¤¶à¥à¤°à¥‡à¤£à¥€ à¤šà¥à¤¨à¥‡à¤‚à¥¤">Please select a category.</span>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">
            <span class="lang" data-en="Description" data-hi="à¤µà¤¿à¤µà¤°à¤£">Description</span>
          </label>
          <textarea class="form-control" id="description" name="description" rows="3" 
                    placeholder="Describe your product..." 
                    data-en="Describe your product..." 
                    data-hi="à¤…à¤ªà¤¨à¥‡ à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤•à¤¾ à¤µà¤°à¥à¤£à¤¨ à¤•à¤°à¥‡à¤‚..."></textarea>
        </div>
      </div>

      <!-- Pricing Section -->
      <div class="form-section">
        <h4 class="section-title">
          <i class="fas fa-rupee-sign section-icon"></i>
          <span class="lang" data-en="Pricing" data-hi="à¤®à¥‚à¤²à¥à¤¯ à¤¨à¤¿à¤°à¥à¤§à¤¾à¤°à¤£">Pricing</span>
        </h4>
        
        <!-- Price Type Toggle -->
        <div class="price-toggle mb-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="isManualPrice" name="isManualPrice">
            <label class="form-check-label" for="isManualPrice">
              <span class="lang" data-en="Set Manual Price" data-hi="à¤®à¥ˆà¤¨à¥à¤¯à¥à¤…à¤² à¤®à¥‚à¤²à¥à¤¯ à¤¸à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚">Set Manual Price</span>
            </label>
          </div>
        </div>

        <!-- Auto Price Field -->
        <div id="autoPriceField">
          <label for="autoPrice" class="form-label">
            <span class="lang" data-en="Auto Price (â‚¹)" data-hi="à¤¸à¥à¤µà¤šà¤¾à¤²à¤¿à¤¤ à¤®à¥‚à¤²à¥à¤¯ (â‚¹)">Auto Price (â‚¹)</span>
          </label>
          <input type="text" class="form-control" id="autoPrice" name="autoPrice" readonly>
          <div class="form-text">
            <span class="lang" data-en="Price calculated automatically based on current market rates" data-hi="à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤¬à¤¾à¤œà¤¾à¤° à¤¦à¤°à¥‹à¤‚ à¤•à¥‡ à¤†à¤§à¤¾à¤° à¤ªà¤° à¤¸à¥à¤µà¤šà¤¾à¤²à¤¿à¤¤ à¤°à¥‚à¤ª à¤¸à¥‡ à¤—à¤£à¤¨à¤¾ à¤•à¥€ à¤—à¤ˆ à¤•à¥€à¤®à¤¤">Price calculated automatically based on current market rates</span>
          </div>
        </div>

        <!-- Manual Price Field -->
        <div class="d-none" id="manualPriceField">
          <label for="manualPrice" class="form-label">
            <span class="lang" data-en="Manual Price (â‚¹)" data-hi="à¤®à¥ˆà¤¨à¥à¤¯à¥à¤…à¤² à¤®à¥‚à¤²à¥à¤¯ (â‚¹)">Manual Price (â‚¹)</span>
          </label>
          <input type="number" step="0.01" min="0" class="form-control" id="manualPrice" name="manualPrice">
          <div class="form-text">
            <span class="lang" data-en="Set your own custom price" data-hi="à¤…à¤ªà¤¨à¥€ à¤•à¤¸à¥à¤Ÿà¤® à¤•à¥€à¤®à¤¤ à¤¸à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚">Set your own custom price</span>
          </div>
        </div>
      </div>

      <!-- Specifications Section -->
      <div class="form-section">
        <h4 class="section-title">
          <i class="fas fa-cogs section-icon"></i>
          <span class="lang" data-en="Specifications" data-hi="à¤µà¤¿à¤¶à¤¿à¤·à¥à¤Ÿà¤¤à¤¾à¤à¤‚">Specifications</span>
        </h4>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="material" class="form-label">
              <span class="lang" data-en="Material" data-hi="à¤¸à¤¾à¤®à¤—à¥à¤°à¥€">Material</span>
              <span class="text-danger">*</span>
            </label>
            <select class="form-select" id="material" name="material" required>
              <option value="">
                <span class="lang" data-en="Select Material" data-hi="à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ à¤šà¥à¤¨à¥‡à¤‚">Select Material</span>
              </option>
              <option value="gold">Gold</option>
              <option value="silver">Silver</option>
              <option value="platinum">Platinum</option>
            </select>
            <div class="invalid-feedback">
              <span class="lang" data-en="Please select a material." data-hi="à¤•à¥ƒà¤ªà¤¯à¤¾ à¤à¤• à¤¸à¤¾à¤®à¤—à¥à¤°à¥€ à¤šà¥à¤¨à¥‡à¤‚à¥¤">Please select a material.</span>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="weight" class="form-label">
              <span class="lang" data-en="Weight" data-hi="à¤µà¤œà¤¨">Weight</span>
              <span class="text-danger">*</span>
            </label>
            <div class="input-group">
              <input type="number" step="0.01" min="0" class="form-control" id="weight" name="specifications[weight]" required>
              <span class="input-group-text">gm</span>
            </div>
            <div class="invalid-feedback">
              <span class="lang" data-en="Please enter product weight." data-hi="à¤•à¥ƒà¤ªà¤¯à¤¾ à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤•à¤¾ à¤µà¤œà¤¨ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚à¥¤">Please enter product weight.</span>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="size" class="form-label">
              <span class="lang" data-en="Size" data-hi="à¤†à¤•à¤¾à¤°">Size</span>
            </label>
            <input type="text" class="form-control" id="size" name="specifications[size]">
            <div class="form-text">
              <span class="lang" data-en="e.g., Small, Medium, Large, or custom dimensions" data-hi="à¤œà¥ˆà¤¸à¥‡ à¤›à¥‹à¤Ÿà¤¾, à¤®à¤§à¥à¤¯à¤®, à¤¬à¤¡à¤¼à¤¾, à¤¯à¤¾ à¤•à¤¸à¥à¤Ÿà¤® à¤†à¤¯à¤¾à¤®">e.g., Small, Medium, Large, or custom dimensions</span>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="metalPurity" class="form-label">
              <span class="lang" data-en="Metal Purity" data-hi="à¤§à¤¾à¤¤à¥ à¤•à¥€ à¤¶à¥à¤¦à¥à¤§à¤¤à¤¾">Metal Purity</span>
            </label>
            <input type="number" class="form-control" id="metalPurity" name="specifications[metalPurity]">
            <div class="form-text">
              <span class="lang" data-en="e.g., 24K, 22K, 18K for Gold or 925 for Silver" data-hi="à¤œà¥ˆà¤¸à¥‡ à¤¸à¥‹à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ 24K, 22K, 18K à¤¯à¤¾ à¤šà¤¾à¤‚à¤¦à¥€ à¤•à¥‡ à¤²à¤¿à¤ 925">e.g., 24K, 22K, 18K for Gold or 925 for Silver</span>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="gemstone" class="form-label">
            <span class="lang" data-en="Gemstone" data-hi="à¤°à¤¤à¥à¤¨">Gemstone</span>
          </label>
          <input type="text" class="form-control" id="gemstone" name="specifications[gemstone]">
          <div class="form-text">
            <span class="lang" data-en="e.g., Diamond, Ruby, Emerald (if applicable)" data-hi="à¤œà¥ˆà¤¸à¥‡ à¤¹à¥€à¤°à¤¾, à¤®à¤¾à¤£à¤¿à¤•, à¤ªà¤¨à¥à¤¨à¤¾ (à¤¯à¤¦à¤¿ à¤²à¤¾à¤—à¥‚ à¤¹à¥‹)">e.g., Diamond, Ruby, Emerald (if applicable)</span>
          </div>
        </div>
      </div>

      <!-- Product Status Section -->
      <div class="form-section">
        <h4 class="section-title">
          <i class="fas fa-toggle-on section-icon"></i>
          <span class="lang" data-en="Product Status" data-hi="à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤¸à¥à¤¥à¤¿à¤¤à¤¿">Product Status</span>
        </h4>
        
        <div class="row">
          <div class="col-md-6">
            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="featured" name="featured">
              <label class="form-check-label" for="featured">
                <span class="lang" data-en="Featured Product" data-hi="à¤«à¥€à¤šà¤°à¥à¤¡ à¤‰à¤¤à¥à¤ªà¤¾à¤¦">Featured Product</span>
              </label>
              <div class="form-text">
                <span class="lang" data-en="Featured products appear prominently on the homepage" data-hi="à¤«à¥€à¤šà¤°à¥à¤¡ à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤¹à¥‹à¤®à¤ªà¥‡à¤œ à¤ªà¤° à¤ªà¥à¤°à¤®à¥à¤–à¤¤à¤¾ à¤¸à¥‡ à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡à¤¤à¥‡ à¤¹à¥ˆà¤‚">Featured products appear prominently on the homepage</span>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" id="inStock" name="inStock" checked>
              <label class="form-check-label" for="inStock">
                <span class="lang" data-en="In Stock" data-hi="à¤¸à¥à¤Ÿà¥‰à¤• à¤®à¥‡à¤‚">In Stock</span>
              </label>
              <div class="form-text">
                <span class="lang" data-en="Uncheck if product is currently unavailable" data-hi="à¤¯à¤¦à¤¿ à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤®à¥‡à¤‚ à¤…à¤¨à¥à¤ªà¤²à¤¬à¥à¤§ à¤¹à¥ˆ à¤¤à¥‹ à¤…à¤¨à¤šà¥‡à¤• à¤•à¤°à¥‡à¤‚">Uncheck if product is currently unavailable</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Image Upload Section -->
      <div class="form-section">
        <h4 class="section-title">
          <i class="fas fa-image section-icon"></i>
          <span class="lang" data-en="Product Image" data-hi="à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤›à¤µà¤¿">Product Image</span>
        </h4>
        
        <div class="mb-3">
          <label for="image" class="form-label">
            <span class="lang" data-en="Upload Image" data-hi="à¤›à¤µà¤¿ à¤…à¤ªà¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚">Upload Image</span>
            <span class="text-danger">*</span>
          </label>
          <input type="file" class="form-control" id="image" name="image" accept="image/*" required>
          <div class="form-text">
            <span class="lang" data-en="Supported formats: JPG, PNG, WEBP. Max size: 5MB" data-hi="à¤¸à¤®à¤°à¥à¤¥à¤¿à¤¤ à¤ªà¥à¤°à¤¾à¤°à¥‚à¤ª: JPG, PNG, WEBPà¥¤ à¤…à¤§à¤¿à¤•à¤¤à¤® à¤†à¤•à¤¾à¤°: 5MB">Supported formats: JPG, PNG, WEBP. Max size: 5MB</span>
          </div>
          <div class="invalid-feedback">
            <span class="lang" data-en="Please upload a valid image file (JPG/PNG/WEBP)." data-hi="à¤•à¥ƒà¤ªà¤¯à¤¾ à¤à¤• à¤µà¥ˆà¤§ à¤›à¤µà¤¿ à¤«à¤¼à¤¾à¤‡à¤² à¤…à¤ªà¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚ (JPG/PNG/WEBP)à¥¤">Please upload a valid image file (JPG/PNG/WEBP).</span>
          </div>
        </div>

        <!-- Image Preview -->
        <div id="imagePreview" class="image-preview-container" style="display: none;">
          <label class="form-label">
            <span class="lang" data-en="Image Preview" data-hi="à¤›à¤µà¤¿ à¤ªà¥‚à¤°à¥à¤µà¤¾à¤µà¤²à¥‹à¤•à¤¨">Image Preview</span>
          </label>
          <div class="text-center">
            <img id="imageThumbnail" class="image-preview">
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="btn-primary-gold">
        <i class="fas fa-plus me-2"></i>
        <span class="lang" data-en="Add Product" data-hi="à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚">Add Product</span>
      </button>
      </div>
    </form>

    <% } %>
  </div>
</div>

<%- include('../partials/footer') %>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const isManualPriceEl = document.getElementById('isManualPrice');
    const manualField = document.getElementById('manualPriceField');
    const autoField = document.getElementById('autoPriceField');
    const manualInput = document.getElementById('manualPrice');
    const autoInput = document.getElementById('autoPrice');
    const materialEl = document.getElementById('material');
    const weightEl = document.getElementById('weight');
    const form = document.getElementById('addProductForm');

    function recalcAutoPrice() {
      const weight = parseFloat(weightEl.value);
      const material = materialEl.value;
      if (!weight || weight <= 0 || !material) {
        autoInput.value = '';
        return;
      }

      // get stored rates from localStorage
      const metalsData = JSON.parse(localStorage.getItem('metalsData'));
      if (!metalsData) {
        autoInput.value = '';
        return;
      }

      let ratePerGram = 0;

      if (material === "gold" && metalsData.gold) {
        ratePerGram = metalsData.gold.ratePerGram;
      } else if (material === "silver" && metalsData.silver) {
        ratePerGram = metalsData.silver.ratePerGram;
      } else if (material === "platinum" && metalsData.platinum) {
        ratePerGram = metalsData.platinum.ratePerGram;
      } else {
        autoInput.value = '';
        return;
      }

      const price = ratePerGram * weight;
      autoInput.value = ratePerGram > 0 ? price.toFixed(2) : '0.00';
    }

    function togglePriceFields() {
      const isManual = isManualPriceEl.checked;
      if (isManual) {
        manualField.classList.remove('d-none');
        autoField.classList.add('d-none');
        manualInput.required = true;
        autoInput.required = false;
      } else {
        manualField.classList.add('d-none');
        autoField.classList.remove('d-none');
        manualInput.required = false;
        autoInput.required = true;
        recalcAutoPrice();
      }
    }

    // Bootstrap validation
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);

    // wire events
    isManualPriceEl.addEventListener('change', togglePriceFields);
    materialEl.addEventListener('change', recalcAutoPrice);
    weightEl.addEventListener('input', recalcAutoPrice);

    // initial state
    togglePriceFields();
    recalcAutoPrice();

    // ðŸ”„ re-calc if rates are updated in another tab/window
    window.addEventListener("storage", function (e) {
      if (e.key === "metalsData") {
        recalcAutoPrice();
      }
    });

    // ðŸ”„ also re-calc if metalsData changes in the same page (rate.ejs updates localStorage)
    setInterval(() => {
      recalcAutoPrice();
    }, 2000); // every 2 seconds refresh price

    // Image preview functionality
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('imagePreview');
    const imageThumbnail = document.getElementById('imageThumbnail');

    imageInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      
      if (file) {
        // Validate file type
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
        if (!allowedTypes.includes(file.type)) {
          alert('Please select a valid image file (JPG, PNG, WEBP)');
          imageInput.value = '';
          imagePreview.style.display = 'none';
          return;
        }

        // Validate file size (5MB limit)
        const maxSize = 5 * 1024 * 1024; // 5MB
        if (file.size > maxSize) {
          alert('File size must be less than 5MB');
          imageInput.value = '';
          imagePreview.style.display = 'none';
          return;
        }

        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
          imageThumbnail.src = e.target.result;
          imagePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        imagePreview.style.display = 'none';
      }
    });

    // Apply current language on page load
    if (typeof window.applyCurrentLanguage === 'function') {
      window.applyCurrentLanguage();
    }
  });
</script>
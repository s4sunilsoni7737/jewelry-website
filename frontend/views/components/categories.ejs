<section class="categories py-5 bg-white" id="categories">
  <div class="container">
    <div class="align-items-center text-center mb-4">
      <h2 class="section-title"
          data-en="Browse by Category"
          data-hi="श्रेणी अनुसार देखें">
        Browse by Category
      </h2>
    </div>

    <div class="row text-center g-3 g-md-4 justify-content-center">
      <% categories.forEach(category => { %>
        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
          <div class="card p-3 p-md-4 border-0 shadow-sm rounded-4 h-100 position-relative category-card">
            <a href="/products/category/<%= category.name %>" class="text-decoration-none text-dark">
              <div class="icon fs-2 fs-md-1 mb-2 mb-md-3" style="color: #e0bf50;">
                <%= category.icon %>
              </div>

              <!-- Category Name -->
              <h6 class="h6 h5-md fw-semibold text-capitalize mb-2">
                <%= category.name %>
              </h6>

              <!-- Category Description -->
              <p class="text-muted small d-none d-md-block">
                <%= category.description %>
              </p>
            </a>

            <% if (session.isSeller) { %>
              <!-- Action buttons -->
              <div class="d-flex justify-content-center gap-1 gap-md-2 mt-2 mt-md-3">
                <a href="/categories/edit/<%= category._id %>" 
                   class="btn btn-outline-primary btn-sm" 
                   title="Edit">
                  <i class="fa fa-edit"></i>
                  <span class="d-none d-md-inline"
                        data-en="Edit"
                        data-hi="संपादित करें">Edit</span>
                </a>

                <button class="btn btn-outline-danger btn-sm" 
                        onclick="showConfirmModal('<%= category._id %>')" 
                        title="Delete">
                  <i class="fa fa-trash"></i>
                  <span class="d-none d-md-inline"
                        data-en="Delete"
                        data-hi="हटाएँ">Delete</span>
                </button>

                <!-- Hidden delete form -->
                <form id="deleteForm-<%= category._id %>" 
                      action="/categories/delete/<%= category._id %>" 
                      method="POST" 
                      style="display: none;">
                </form>
              </div>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>

    <% if (session?.isSeller) { %>
      <div class="text-center mt-4 mt-md-5">
        <a href="/categories/add" class="btn btn-warning">
          <i class="fa-solid fa-plus"></i> 
          <span class="d-none d-sm-inline"
                data-en="Add New Category"
                data-hi="नई श्रेणी जोड़ें">Add New Category</span>
          <span class="d-inline d-sm-none"
                data-en="Add"
                data-hi="जोड़ें">Add</span>
        </a>
      </div>
    <% } %>
  </div>
</section>

<!-- Modal for confirmation -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow">
      <div class="modal-header border-0">
        <h5 class="modal-title text-warning" id="confirmModalLabel">
          <i class="fa fa-exclamation-triangle me-2"></i>
          <span data-en="Confirm Deletion" data-hi="हटाने की पुष्टि करें">Confirm Deletion</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center py-4">
        <p class="mb-0"
           data-en="Are you sure you want to delete this category?"
           data-hi="क्या आप वाकई इस श्रेणी को हटाना चाहते हैं?">
          Are you sure you want to delete this category?
        </p>
        <small class="text-muted"
               data-en="This action cannot be undone."
               data-hi="यह क्रिया वापस नहीं ली जा सकती।">
          This action cannot be undone.
        </small>
      </div>
      <div class="modal-footer justify-content-center border-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                data-en="Cancel"
                data-hi="रद्द करें">Cancel</button>
        <button id="confirmDeleteBtn" type="button" class="btn btn-danger">
          <i class="fa fa-trash me-1"></i>
          <span data-en="Yes, Delete" data-hi="हाँ, हटाएँ">Yes, Delete</span>
        </button>
      </div>
    </div>
  </div>
</div>


<style>
  /* Category card hover effects */
  .category-card {
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }
  
  .category-card:hover {
    transform: translateY(-5px);
 box-shadow: 0 20px 50px rgba(224, 191, 80, 0.25);
  border-color: #e0bf50 !important;
  }
  
  .category-card .icon {
    transition: transform 0.3s ease;
  }
  
  .category-card:hover .icon {
    transform: scale(1.1);
  }
  
  /* Mobile specific styles */
  @media (max-width: 768px) {
    .categories .section-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .category-card {
      padding: 1rem 0.75rem;
    }
    
    .category-card .icon {
      font-size: 2rem !important;
      margin-bottom: 0.75rem !important;
    }
    
    .category-card h6 {
      font-size: 0.9rem;
      line-height: 1.2;
    }
    
    .category-card .btn {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
    }
  }
  
  @media (max-width: 576px) {
    .category-card {
      padding: 0.75rem 0.5rem;
    }
    
    .category-card .icon {
      font-size: 1.75rem !important;
      margin-bottom: 0.5rem !important;
    }
    
    .category-card h6 {
      font-size: 0.8rem;
    }
  }
</style>
<script src="/public/js/script.js"></script>
<script>
  let formToSubmit = null;

  function showConfirmModal(categoryId) {
    formToSubmit = document.getElementById(`deleteForm-${categoryId}`);
    const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));
    confirmModal.show();
  }

  document.getElementById('confirmDeleteBtn').addEventListener('click', function () {
    if (formToSubmit) {
      formToSubmit.submit();
    }
  });
</script>